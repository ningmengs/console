/*
 * console v1.0.0
 * (c) 2017 xiaojue
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";function e(e,t){if("undefined"==typeof document)return t;e=e||"";var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e)),n.appendChild(o),t}e('/**\n * @fileoverview  console style\n */\n\n.-c-switch{\n    display: block;\n    position: fixed;\n    right: 10px;\n    bottom: 10px;\n    z-index: 2147483647;\n    border-radius: 4px;\n    box-shadow: 0 0 8px rgba( 0, 0, 0, .4);\n    padding: 8px 16px;\n    line-height: 1;\n    font-size: 14px;\n    color: #fff;\n    background-color: #0088cc;\n}\n\n.-c-content,.-c-eles{\n    display: none;\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 40px;\n    z-index: 2147483647;\n    border-top: 1px solid #eee;\n    overflow-x: hidden;\n    overflow-y: auto;\n    max-height: 50%;\n    background-color: #cbf3ff;\n    -webkit-overflow-scrolling: touch;\n    border-top:1px solid #d9d9d9;\n    opacity:.7;\n}\n\n.-c-log{\n    margin: 0;\n    border-bottom: 1px solid #eee;\n    padding: 6px 8px;\n    overflow: hidden;\n    line-height: 1.3;\n    word-break: break-word;\n}\n\n.-c-toolbar,.-c-tab{\n    display: none;\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    height:40px;\n    z-index: 2147483647;\n    line-height: 40px;\n    background-color: #cbf3ff;\n    opacity:.7;\n}\n\n.-c-tab{\n    top:0px;\n}\n\n.-c-tool{\n    position: relative;\n    float: left;\n    width: 50%;\n    text-align: center;\n    text-decoration: none;\n    color: #000;\n}\n\n.-c-clear::before,.-c-console::before,.-c-refresh::before{\n    content: "";\n    position: absolute;\n    top: 7px;\n    bottom: 7px;\n    right: 0;\n    border-left: 1px solid #d9d9d9;\n}\n\n.-c-current{\n    color:#0088cc;\n}\n\n.-c-eles div{\n    font-size:12px;\n    color:#990884;\n    margin:5px;\n}\n.-c-eles span{\n    color:#444;\n}\n.-c-eles span.val{\n    color:#1f6b7a;\n}\n.-c-eles span.key{\n    color:#900b09;\n}\n.-c-eles .-c-omit{\n    display:none;\n}\n\n@-webkit-keyframes twinkling{\n    0%{\n        opacity:0;\n    }\n    100%{\n        background-color:green;\n        opacity:0.5;\n    }\n}\n\n.-c-dialog {\n    width:80%;\n    height:auto;\n    border:#ccc solid 1px;\n    margin-top:20%;\n    background:#eee;\n}\n.-c-dialog .textareaParent{\n    position:relative;\n}\n.-c-dialog .textareaParent pre{\n\tdisplay:block;\n    visibility:hidden; \n\tmargin:0;\n\twhite-space: pre-wrap; \n    word-wrap: break-word; \n}\n.-c-dialog .textareaParent pre span{\n    font-size:12px; \n\tdisplay:block;\n}\n.-c-dialog textarea{\n    outline:none;\n    resize:none;\n    border:none;\n    left:0px;\n    top:0px;\n    position:absolute;\n    width:100%;\n    height:100%;\n    font-size:12px; \n}\n.-c-dialog .-c-elepath{\n    font-size:12px;\n    color:green;\n}\n',void 0);var t='<div id="__console">\n    <dialog class="-c-dialog">\n        <div class="textareaParent">\n            <pre><span class="-c-textare_pre"></span><br></pre>\n            <textarea class="__console_currentStyle"></textarea>\n        </div>\n        <p> <button class="-c-cancel">Cancel</button> <button class="-c-save">Save</button> <p class="-c-elepath"></p></p>\n    </dialog>\n    <div class="-c-switch">Console</div>\n    <div class="-c-content"></div>\n    <div class="-c-eles"></div>\n    <div class="-c-toolbar -c-consoleBar">\n        <div class="-c-tool -c-clear">Clear</div>\n        <div class="-c-tool -c-hide">Hide</div>\n    </div>\n    <div class="-c-toolbar -c-eleBar">\n        <div class="-c-tool -c-refresh">Refresh</div>\n        <div class="-c-tool -c-hide">Hide</div>\n    </div>\n    <div class="-c-tab">\n        <div class="-c-tool -c-console -c-current">Console</div>\n        <div class="-c-tool -c-elements">Elemenets</div>\n    </div>\n</div>\n',n=function(){this.delegateEventSplitter=/^(\S+)\s*(.*)$/,this.events&&this._bindEventMap()};n.prototype.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},n.prototype.$=function(e){return document.querySelector(e)},n.prototype._bindEventMap=function(){var e=this;for(var t in this.events)if(e.events.hasOwnProperty(t)){var n=e.events[t];if(e.isFunction(n)||(n=e[n]),!n)continue;var o=t.match(e.delegateEventSplitter),i=o[1],s=o[2];e.$(s).addEventListener(i,n.bind(e))}};var o,i=function(e){function t(){e.call(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createElement=function(e,t,n){var o,i=document.createElement(e);for(o in t)t.hasOwnProperty(o)&&i.setAttribute(o,t[o]);return n&&this.html(i,n),i},t.prototype.show=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return e.forEach(function(e){e.style.display="block"}),this},t.prototype.hide=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return e.forEach(function(e){e.style.display="none"}),this},t.prototype.append=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return t.forEach(function(t){e.appendChild(t)}),this},t.prototype._put=function(e,t){for(var n=[],o=arguments.length-2;o-- >0;)n[o]=arguments[o+2];n.forEach(function(n){t?"string"==typeof n.textContent?n.textContent=e:n.innerText=e:n.innerHTML=e})},t.prototype.html=function e(t,e){this._put(e,0,t)},t.prototype.text=function e(t,e){this._put(e,1,t)},t.prototype.addClass=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return t.forEach(function(t){t.classList.add(e)}),this},t.prototype.removeClass=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return t.forEach(function(t){t.classList.remove(e)}),this},t}(n),s=function(e){function t(t){var n=this;if(Object.assign(this,t),this.render(),this.eles)for(var o in this.eles)n.eles.hasOwnProperty(o)&&(n[o]=n.$(n.eles[o]));return e.call(this),this.init(),this}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){},t}(i),c={fixConsole:function(){var e=this;this.consoleMethods.forEach(function(t){var n=window.console[t];window.console[t]=function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];e.pushLog&&e.pushLog(t),n.apply(console,t)}})}},r=0,l={},a={refreshDomTree:function(e){var t=this._recursionNode(document,[]);this.removeAllListeners(e,"click"),this.removeAllListeners(e,"touchstart"),this.removeAllListeners(e,"touchend"),e.innerHTML=t.join(""),this.addListener(e,"touchstart",this._touchStart.bind(this),!1),this.addListener(e,"touchend",this._touchEnd.bind(this),!1),this.addListener(e,"click",this._toggleDiv.bind(this),!1),this._eachOmit(e.querySelectorAll(".-c-omit"))},createDomTree:function(e){var t=this._recursionNode(document,[]);e.innerHTML=t.join(""),this.addListener(e,"click",this._toggleDiv.bind(this),!1),this.addListener(e,"touchstart",this._touchStart.bind(this),!1),this.addListener(e,"touchend",this._touchEnd.bind(this),!1),this._eachOmit(e.querySelectorAll(".-c-omit"))},changeStyle:function(){var e=this.dialog,t="";try{t=JSON.parse(e.querySelector(".__console_currentStyle").value)}catch(e){return void console.error("rewrite style must be standard JSON object string")}var n=e.querySelector(".__console_currentStyle").getAttribute("data-uuid"),o=document.querySelector('[console_uuid="'+n+'"]'),i=t.sheets.join().replace(/(\}.*?\{)/g,"").replace(/(.*?\{)/g,"").replace(/(\}$)/,"");o.style.cssText=t.cssText+i,e.close(),this.refresh()},longPress:function(e){this._showStyle(e)},_touchStart:function(e){var t=this;o=setTimeout(function(){t.longPress(e)},800)},_touchEnd:function(){clearTimeout(o)},css:function(e){var t,n=document.styleSheets,o={},i=[];e.matches=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector;for(t in n)if(n.hasOwnProperty(t)){var s=n[t].rules||n[t].cssRules;for(var c in s)e.matches(s[c].selectorText)&&i.push(s[c].cssText)}o.sheets=i;var r=e.style.cssText;return r&&(o.cssText=r),o},_showStyle:function(e){var t=e.target;if(1===t.nodeType&&"div"===t.tagName.toLowerCase()){var n=t.getAttribute("data-uuid"),o=document.querySelector('[console_uuid="'+n+'"]'),i=JSON.stringify(this.css(o)),s=this.dialog;s.querySelector(".__console_currentStyle").value=i,s.querySelector(".__console_currentStyle").setAttribute("data-uuid",n),s.querySelector(".-c-elepath").innerText=t.innerText,s.querySelector(".-c-textare_pre").innerText=i,s.show()}},_showBorder:function(e){var t=["html","head","title","meta","body","script","style"];t.indexOf(e.tagName.toLocaleLowerCase())>-1||(e.style["-webkit-animation"]="twinkling .5s infinite ease-in-out",setTimeout(function(){e.style["-webkit-animation"]=""},500),this._setTargetY(e))},_setTargetY:function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetTop,n+=e.offsetParent?e.offsetParent.scrollTop:0;while(e=e.offsetParent);window.scrollTop=t-n},_toggleDiv:function(e){var t=e.target;if(1===t.nodeType&&"div"===t.tagName.toLowerCase()){for(var n=0;n<t.childNodes.length;n++){var o=t.childNodes[n];1===o.nodeType&&"div"===o.tagName.toLowerCase()&&(o.style.display="block"===o.style.display?"none":"block")}var i=t.getAttribute("data-uuid"),s=document.querySelector('[console_uuid="'+i+'"]');this._showBorder(s),this._eachOmit(t.querySelectorAll(".-c-omit"))}},_eachOmit:function(e){e.forEach(function(e){for(var t=e.nextSibling;null===t&&1!==t.nodeType;)t=e.nextSibling;t&&(1===t.nodeType&&"DIV"===t.tagName?e.style.display="block"===t.style.display?"none":"inline":e.style.display="none")})},addListener:function(e,t,n,o){e in l||(l[e]={}),t in l[e]||(l[e][t]=[]),l[e][t].push([n,o]),e.addEventListener(t,n,o)},removeAllListeners:function(e,t){if(e in l){var n=l[e];if(t in n)for(var o=n[t],i=o.length;i--;){var s=o[i];e.removeEventListener(t,s[0],s[1])}}},_recursionNode:function(e,t){var n=this,o=0,i=10;if(e.childNodes.length){e.tagName&&t.push('<span class="-c-omit" style="display:none;">...</span>'),o+=i;for(var s=0;s<e.childNodes.length;s++){var c=e.childNodes[s];if(3===c.nodeType&&""!==c.nodeValue.trim()&&t.push("<span>"+c.nodeValue.trim()+"</span>"),1===c.nodeType){var l=c.tagName.toLowerCase();if("__console_wrap"===c.id)continue;var a="html"===l||"head"===l||"body"===l?"block":"none",d="";c.setAttribute("console_uuid",r),Object.keys(c.attributes).forEach(function(e){var t=c.attributes[e];"console_uuid"!==t.name&&(d+='<span class="key">'+t.name+'</span>="<span class="val">'+t.textContent+'</span>" ')}),t.push('<div data-uuid="'+r+'" style="display:'+a+";margin-left:"+o+'px;">&lt;'+l+" "+d+"&gt;"),r++,n._recursionNode(c,t),t.push("&lt;/"+l+"&gt;</div>")}}}return t}};Object.assign(s.prototype,c),Object.assign(s.prototype,a),new s({init:function(){this.consoleMethods=["debug","error","info","warn","log"],this.elesInit=!1,this.fixConsole()},events:{"click .-c-switch":"switchBtnClick","click .-c-clear":"clearClick","click .-c-consoleBar .-c-hide":"hideClick","click .-c-eleBar .-c-hide":"hideClick","click .-c-elements":"elementsClick","click .-c-refresh":"refresh","click .-c-console":"consoleClick","click .-c-save":"saveStyle","click .-c-cancel":"cancel"},eles:{elesBox:".-c-eles",logBox:".-c-content",consoletoolBar:".-c-consoleBar",elestoolBar:".-c-eleBar",switchBtn:".-c-switch",tab:".-c-tab",elesTab:".-c-elements",dialog:".-c-dialog",consoleTab:".-c-console"},render:function(){this.el=this.createElement("div",{id:"__console_wrap"},t),this.append(document.body,this.el)},pushLog:function(e){var t=this.createElement("div",{class:"-c-log"});this.text(t,JSON.stringify(e.join(" ")).slice(1,-1)),this.append(this.logBox,t)},cancel:function(){this.dialog.close()},saveStyle:function(){this.changeStyle()},switchBtnClick:function(){this.show(this.logBox,this.elesBox,this.consoletoolBar,this.elestoolBar,this.tab).hide(this.switchBtn,this.elestoolBar)},clearClick:function(){this.html(this.logBox,"")},hideClick:function(){this.hide(this.logBox,this.elesBox,this.consoletoolBar,this.elestoolBar,this.tab).show(this.switchBtn),this.addClass("-c-current",this.consoleTab).removeClass("-c-current",this.elesTab)},elementsClick:function(){this.hide(this.logBox,this.consoletoolBar).show(this.elesBox,this.elestoolBar),this.addClass("-c-current",this.elesTab).removeClass("-c-current",this.consoleTab),this.elesInit||(this.elesInit=!0,this.createDomTree(this.elesBox))},consoleClick:function(){this.hide(this.elesBox,this.elestoolBar).show(this.logBox,this.consoletoolBar),this.addClass("-c-current",this.consoleTab).removeClass("-c-current",this.elesTab)},refresh:function(){this.refreshDomTree(this.elesBox)}})});